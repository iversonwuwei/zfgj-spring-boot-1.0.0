<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dlfc.zfgj.mapper.AgtCusInfoMapper">
  <resultMap id="BaseResultMap" type="com.dlfc.zfgj.entity.AgtCusInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="PINDEX" jdbcType="INTEGER" property="pindex" />
    <result column="CUSTOMER_ID" jdbcType="VARCHAR" property="customerId" />
    <result column="EID" jdbcType="VARCHAR" property="eid" />
    <result column="CID" jdbcType="VARCHAR" property="cid" />
    <result column="GENDER" jdbcType="INTEGER" property="gender" />
    <result column="RESOURCE" jdbcType="INTEGER" property="resource" />
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="MOBILE" jdbcType="VARCHAR" property="mobile" />
    <result column="STATUS" jdbcType="SMALLINT" property="status" />
    <result column="REQUIREMENT" jdbcType="VARCHAR" property="requirement" />
    <result column="CREATE_USER" jdbcType="VARCHAR" property="createUser" />
    <result column="CREATE_USER_IDENTITY" jdbcType="SMALLINT" property="createUserIdentity" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
    <result column="MODIFY_USER" jdbcType="VARCHAR" property="modifyUser" />
    <result column="MODIFY_USER_IDENTITY" jdbcType="SMALLINT" property="modifyUserIdentity" />
    <result column="MODIFY_TIME" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="DELETE_FLG" jdbcType="SMALLINT" property="deleteFlg" />
    <result column="VERSION" jdbcType="INTEGER" property="version" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    ID, PINDEX, CUSTOMER_ID, EID, CID, GENDER, RESOURCE, NAME, MOBILE, STATUS, REQUIREMENT, 
    CREATE_USER, CREATE_USER_IDENTITY, CREATE_TIME, MODIFY_USER, MODIFY_USER_IDENTITY, 
    MODIFY_TIME, DELETE_FLG, VERSION
  </sql>
  <select id="selectByExample" parameterType="com.dlfc.zfgj.entity.AgtCusInfoExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from agt_cus_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from agt_cus_info
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    delete from agt_cus_info
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteByExample" parameterType="com.dlfc.zfgj.entity.AgtCusInfoExample">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    delete from agt_cus_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.dlfc.zfgj.entity.AgtCusInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    insert into agt_cus_info (ID, PINDEX, CUSTOMER_ID, 
      EID, CID, GENDER, RESOURCE, 
      NAME, MOBILE, STATUS, 
      REQUIREMENT, CREATE_USER, CREATE_USER_IDENTITY, 
      CREATE_TIME, MODIFY_USER, MODIFY_USER_IDENTITY, 
      MODIFY_TIME, DELETE_FLG, VERSION
      )
    values (#{id,jdbcType=VARCHAR}, #{pindex,jdbcType=INTEGER}, #{customerId,jdbcType=VARCHAR}, 
      #{eid,jdbcType=VARCHAR}, #{cid,jdbcType=VARCHAR}, #{gender,jdbcType=INTEGER}, #{resource,jdbcType=INTEGER}, 
      #{name,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, #{status,jdbcType=SMALLINT}, 
      #{requirement,jdbcType=VARCHAR}, #{createUser,jdbcType=VARCHAR}, #{createUserIdentity,jdbcType=SMALLINT}, 
      #{createTime,jdbcType=TIMESTAMP}, #{modifyUser,jdbcType=VARCHAR}, #{modifyUserIdentity,jdbcType=SMALLINT}, 
      #{modifyTime,jdbcType=TIMESTAMP}, #{deleteFlg,jdbcType=SMALLINT}, #{version,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.dlfc.zfgj.entity.AgtCusInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    insert into agt_cus_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="pindex != null">
        PINDEX,
      </if>
      <if test="customerId != null">
        CUSTOMER_ID,
      </if>
      <if test="eid != null">
        EID,
      </if>
      <if test="cid != null">
        CID,
      </if>
      <if test="gender != null">
        GENDER,
      </if>
      <if test="resource != null">
        RESOURCE,
      </if>
      <if test="name != null">
        NAME,
      </if>
      <if test="mobile != null">
        MOBILE,
      </if>
      <if test="status != null">
        STATUS,
      </if>
      <if test="requirement != null">
        REQUIREMENT,
      </if>
      <if test="createUser != null">
        CREATE_USER,
      </if>
      <if test="createUserIdentity != null">
        CREATE_USER_IDENTITY,
      </if>
      <if test="createTime != null">
        CREATE_TIME,
      </if>
      <if test="modifyUser != null">
        MODIFY_USER,
      </if>
      <if test="modifyUserIdentity != null">
        MODIFY_USER_IDENTITY,
      </if>
      <if test="modifyTime != null">
        MODIFY_TIME,
      </if>
      <if test="deleteFlg != null">
        DELETE_FLG,
      </if>
      <if test="version != null">
        VERSION,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="pindex != null">
        #{pindex,jdbcType=INTEGER},
      </if>
      <if test="customerId != null">
        #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="eid != null">
        #{eid,jdbcType=VARCHAR},
      </if>
      <if test="cid != null">
        #{cid,jdbcType=VARCHAR},
      </if>
      <if test="gender != null">
        #{gender,jdbcType=INTEGER},
      </if>
      <if test="resource != null">
        #{resource,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null">
        #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        #{status,jdbcType=SMALLINT},
      </if>
      <if test="requirement != null">
        #{requirement,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createUserIdentity != null">
        #{createUserIdentity,jdbcType=SMALLINT},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyUser != null">
        #{modifyUser,jdbcType=VARCHAR},
      </if>
      <if test="modifyUserIdentity != null">
        #{modifyUserIdentity,jdbcType=SMALLINT},
      </if>
      <if test="modifyTime != null">
        #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteFlg != null">
        #{deleteFlg,jdbcType=SMALLINT},
      </if>
      <if test="version != null">
        #{version,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.dlfc.zfgj.entity.AgtCusInfoExample" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    select count(*) from agt_cus_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    update agt_cus_info
    <set>
      <if test="record.id != null">
        ID = #{record.id,jdbcType=VARCHAR},
      </if>
      <if test="record.pindex != null">
        PINDEX = #{record.pindex,jdbcType=INTEGER},
      </if>
      <if test="record.customerId != null">
        CUSTOMER_ID = #{record.customerId,jdbcType=VARCHAR},
      </if>
      <if test="record.eid != null">
        EID = #{record.eid,jdbcType=VARCHAR},
      </if>
      <if test="record.cid != null">
        CID = #{record.cid,jdbcType=VARCHAR},
      </if>
      <if test="record.gender != null">
        GENDER = #{record.gender,jdbcType=INTEGER},
      </if>
      <if test="record.resource != null">
        RESOURCE = #{record.resource,jdbcType=INTEGER},
      </if>
      <if test="record.name != null">
        NAME = #{record.name,jdbcType=VARCHAR},
      </if>
      <if test="record.mobile != null">
        MOBILE = #{record.mobile,jdbcType=VARCHAR},
      </if>
      <if test="record.status != null">
        STATUS = #{record.status,jdbcType=SMALLINT},
      </if>
      <if test="record.requirement != null">
        REQUIREMENT = #{record.requirement,jdbcType=VARCHAR},
      </if>
      <if test="record.createUser != null">
        CREATE_USER = #{record.createUser,jdbcType=VARCHAR},
      </if>
      <if test="record.createUserIdentity != null">
        CREATE_USER_IDENTITY = #{record.createUserIdentity,jdbcType=SMALLINT},
      </if>
      <if test="record.createTime != null">
        CREATE_TIME = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.modifyUser != null">
        MODIFY_USER = #{record.modifyUser,jdbcType=VARCHAR},
      </if>
      <if test="record.modifyUserIdentity != null">
        MODIFY_USER_IDENTITY = #{record.modifyUserIdentity,jdbcType=SMALLINT},
      </if>
      <if test="record.modifyTime != null">
        MODIFY_TIME = #{record.modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.deleteFlg != null">
        DELETE_FLG = #{record.deleteFlg,jdbcType=SMALLINT},
      </if>
      <if test="record.version != null">
        VERSION = #{record.version,jdbcType=INTEGER},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    update agt_cus_info
    set ID = #{record.id,jdbcType=VARCHAR},
      PINDEX = #{record.pindex,jdbcType=INTEGER},
      CUSTOMER_ID = #{record.customerId,jdbcType=VARCHAR},
      EID = #{record.eid,jdbcType=VARCHAR},
      CID = #{record.cid,jdbcType=VARCHAR},
      GENDER = #{record.gender,jdbcType=INTEGER},
      RESOURCE = #{record.resource,jdbcType=INTEGER},
      NAME = #{record.name,jdbcType=VARCHAR},
      MOBILE = #{record.mobile,jdbcType=VARCHAR},
      STATUS = #{record.status,jdbcType=SMALLINT},
      REQUIREMENT = #{record.requirement,jdbcType=VARCHAR},
      CREATE_USER = #{record.createUser,jdbcType=VARCHAR},
      CREATE_USER_IDENTITY = #{record.createUserIdentity,jdbcType=SMALLINT},
      CREATE_TIME = #{record.createTime,jdbcType=TIMESTAMP},
      MODIFY_USER = #{record.modifyUser,jdbcType=VARCHAR},
      MODIFY_USER_IDENTITY = #{record.modifyUserIdentity,jdbcType=SMALLINT},
      MODIFY_TIME = #{record.modifyTime,jdbcType=TIMESTAMP},
      DELETE_FLG = #{record.deleteFlg,jdbcType=SMALLINT},
      VERSION = #{record.version,jdbcType=INTEGER}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.dlfc.zfgj.entity.AgtCusInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    update agt_cus_info
    <set>
      <if test="pindex != null">
        PINDEX = #{pindex,jdbcType=INTEGER},
      </if>
      <if test="customerId != null">
        CUSTOMER_ID = #{customerId,jdbcType=VARCHAR},
      </if>
      <if test="eid != null">
        EID = #{eid,jdbcType=VARCHAR},
      </if>
      <if test="cid != null">
        CID = #{cid,jdbcType=VARCHAR},
      </if>
      <if test="gender != null">
        GENDER = #{gender,jdbcType=INTEGER},
      </if>
      <if test="resource != null">
        RESOURCE = #{resource,jdbcType=INTEGER},
      </if>
      <if test="name != null">
        NAME = #{name,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null">
        MOBILE = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        STATUS = #{status,jdbcType=SMALLINT},
      </if>
      <if test="requirement != null">
        REQUIREMENT = #{requirement,jdbcType=VARCHAR},
      </if>
      <if test="createUser != null">
        CREATE_USER = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createUserIdentity != null">
        CREATE_USER_IDENTITY = #{createUserIdentity,jdbcType=SMALLINT},
      </if>
      <if test="createTime != null">
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modifyUser != null">
        MODIFY_USER = #{modifyUser,jdbcType=VARCHAR},
      </if>
      <if test="modifyUserIdentity != null">
        MODIFY_USER_IDENTITY = #{modifyUserIdentity,jdbcType=SMALLINT},
      </if>
      <if test="modifyTime != null">
        MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      </if>
      <if test="deleteFlg != null">
        DELETE_FLG = #{deleteFlg,jdbcType=SMALLINT},
      </if>
      <if test="version != null">
        VERSION = #{version,jdbcType=INTEGER},
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.dlfc.zfgj.entity.AgtCusInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 24 09:37:43 CST 2015.
    -->
    update agt_cus_info
    set PINDEX = #{pindex,jdbcType=INTEGER},
      CUSTOMER_ID = #{customerId,jdbcType=VARCHAR},
      EID = #{eid,jdbcType=VARCHAR},
      CID = #{cid,jdbcType=VARCHAR},
      GENDER = #{gender,jdbcType=INTEGER},
      RESOURCE = #{resource,jdbcType=INTEGER},
      NAME = #{name,jdbcType=VARCHAR},
      MOBILE = #{mobile,jdbcType=VARCHAR},
      STATUS = #{status,jdbcType=SMALLINT},
      REQUIREMENT = #{requirement,jdbcType=VARCHAR},
      CREATE_USER = #{createUser,jdbcType=VARCHAR},
      CREATE_USER_IDENTITY = #{createUserIdentity,jdbcType=SMALLINT},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      MODIFY_USER = #{modifyUser,jdbcType=VARCHAR},
      MODIFY_USER_IDENTITY = #{modifyUserIdentity,jdbcType=SMALLINT},
      MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP},
      DELETE_FLG = #{deleteFlg,jdbcType=SMALLINT},
      VERSION = #{version,jdbcType=INTEGER}
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  
  	<resultMap id="custResultMap" type="com.dlfc.zfgj.entity.AgtCusInfo">
		<id column="ID" jdbcType="VARCHAR" property="id" /> 
		<association column="ID" property="comments" select="com.dlfc.zfgj.mapper.AgtCusCommentMapper.findCommentList" />
		<association column="ID" property="requirements" select="com.dlfc.zfgj.mapper.AgtRequirementInfoMapper.findRequirementList" />
	</resultMap>

	<!-- 展示 -->
	<select id="selectCustInfoList" parameterType="com.dlfc.zfgj.entity.AgtCusInfo" resultType="com.dlfc.zfgj.entity.AgtCusInfo" useCache="false">
		SELECT
			A.ID,
			A.EID,
			A.NAME,
			A.MOBILE,
			A.STATUS,
			A.REQUIREMENT,
			A.CREATE_USER,
			A.CREATE_TIME,
			A.DELETE_FLG,
			A.VERSION,
			A.RESOURCE,
			(SELECT NAME FROM SYS_CODE WHERE TYPE = 'cust_source' AND CODE = A.RESOURCE) RESOURCENAME,
			A.GENDER,
			A.CID,
			B.START_TIME,
			B.END_TIME,
			B.MONTHLY_RENT,
			(SELECT NAME FROM SYS_CODE WHERE TYPE = 'rental_mode' AND CODE = B.RENTAL_MODE) RENTAL_MODE,
			B.HOUSE_ADDR
		FROM
			AGT_CUS_INFO A
			LEFT JOIN CON_CONTRACT B ON A.CID = B.ID AND B.STATUS IN (5,6,7,8,12) 
		WHERE
			1 = 1 AND A.DELETE_FLG = 0  AND A.EID IN (${customerId} )
		
		<choose>
			<when test="status != null and status != ''">
				AND A.STATUS = 4
			</when>
			<otherwise>
				AND A.STATUS != 4
			</otherwise>
		</choose>
		
		<choose>
			<when test="orderBy != null and orderBy != ''">
				ORDER BY ${orderBy}
			</when>
			<otherwise>
				ORDER BY A.CREATE_TIME DESC
			</otherwise>
		</choose>
		
	</select>
	<select id="selectAllCustInfoCount" parameterType="com.dlfc.zfgj.entity.AgtCusInfo" resultType="int" useCache="false">
        SELECT COUNT(1)
        FROM
            AGT_CUS_INFO A
            LEFT JOIN CON_CONTRACT B ON A.CID = B.ID AND B.STATUS IN (5,6,7,8,12)
            INNER JOIN AGT_EMP_INFO E ON A.EID = E.ID
            INNER JOIN USR_USER U ON E.USER_ID = U.ID
            INNER JOIN SYS_PERSON S ON S.ID = U.PER_ID
            
        WHERE
            1 = 1 AND A.DELETE_FLG = 0 AND A.EID IN (${customerId} )
            
       <if test="name != null">
       and ( A.name like  CONCAT('%',#{name},'%')
       OR
          S.NAME like  CONCAT('%',#{name},'%')
          <if test="statusName != null">
       OR A.STATUS like  CONCAT('%',#{statusName},'%')
       </if>
       )
       </if>
    <choose>
            <when test="status == 2">
                AND A.STATUS = 2
            </when>
            <!-- <when test="status == 3">
                AND A.STATUS = 3
            </when> -->
            <when test="status == 4">
                AND A.STATUS = 4
            </when>
            <when test="status == 1">
                AND A.STATUS  != 4
            </when>
    </choose>
    
    </select>
	<select id="selectAllCustInfoList" parameterType="com.dlfc.zfgj.entity.AgtCusInfo" resultMap="custResultMap" useCache="false">
		SELECT
			A.ID,
			A.EID,
			A.NAME,
			A.MOBILE,
			A.STATUS,
			A.REQUIREMENT,
			A.DELETE_FLG,
			A.VERSION,
			(SELECT NAME FROM SYS_CODE WHERE TYPE = 'cust_source' AND CODE = A.RESOURCE) RESOURCENAME,
			(SELECT NAME FROM SYS_CODE WHERE TYPE = 'cust_status' AND CODE = A.STATUS) STATUSNAME,
			A.GENDER,
			A.CID,
			B.START_TIME,
			B.END_TIME,
			B.MONTHLY_RENT,
			(SELECT NAME FROM SYS_CODE WHERE TYPE = 'rental_mode' AND CODE = B.RENTAL_MODE) RENTAL_MODE,
			B.HOUSE_ADDR,
			S.NAME PERSON_NAME
		FROM
			AGT_CUS_INFO A
			LEFT JOIN CON_CONTRACT B ON A.CID = B.ID AND B.STATUS IN (5,6,7,8,12)
			INNER JOIN AGT_EMP_INFO E ON A.EID = E.ID
            INNER JOIN USR_USER U ON E.USER_ID = U.ID
            INNER JOIN SYS_PERSON S ON S.ID = U.PER_ID
             
		WHERE
			1 = 1 AND A.DELETE_FLG = 0 AND A.EID IN (${customerId} )
			
			
			
	   <if test="name != null">
	   and ( A.name like  CONCAT('%',#{name},'%')
       OR
	      S.NAME like  CONCAT('%',#{name},'%')
	      <if test="statusName != null">
	   OR A.STATUS like  CONCAT('%',#{statusName},'%')
	   </if>
	   )
       </if>
	<choose>
			<when test="status == 2">
				AND A.STATUS = 2
			</when>
			<!-- <when test="status == 3">
				AND A.STATUS = 3
			</when> -->
			<when test="status == 4">
				AND A.STATUS = 4
			</when>
			<when test="status == 1">
				AND A.STATUS  != 4
			</when>
	</choose>
	    <choose>
			<when test="orderBy != null and orderBy != ''">
				ORDER BY ${orderBy}
			</when>
			<otherwise>
				ORDER BY A.CREATE_TIME DESC
			</otherwise>
		</choose>
	
	</select>
	
	<select id="selectByEid" parameterType="java.lang.String" resultType="java.lang.Integer" useCache="false">
	    select 
	    count(*)
	    from agt_cus_info
	    where EID = #{id,jdbcType=VARCHAR} AND DELETE_FLG = 0
  	</select>
</mapper>